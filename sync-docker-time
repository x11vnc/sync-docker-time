#!/bin/bash

#  docker-sync-time.sh
#  docker-sync-time
#
#  Created by ArunvelSriram on 26/12/16.
#  Copyright Â© 2016 ArunvelSriram. All rights reserved.

# Wait for reconnection for 30 seconds
for i in {1..30}; do
  nc 8.8.8.8 53 -z 2> /dev/null
  if [ $? -eq 0 ]; then
    # Call docker to sync time and quite only if received reply fro ntpd
    docker run --rm --privileged --pid=host walkerlee/nsenter \
      -t 1 -m -u -i -n ntpd -d -q -n -p pool.ntp.org 2>&1 |
      grep "ntpd: reply from" && break
  fi
  sleep 5
done
